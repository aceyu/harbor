<section class="overview-section">
  <div class="title-wrapper">
    <div class="title-block arrow-block" *ngIf="withAdmiral">	
       <clr-icon class="rotate-90 arrow-back" shape="arrow" size="36" (click)="goBack()"></clr-icon>
    </div>
    <div class="title-block">
      <h2 sub-header-title class="custom-h2">{{repoName}}</h2>
    </div>
  </div>
</section>

<section class="detail-section">
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <span class="spinner spinner-inline" [hidden]="inProgress === false"></span>
    <ul id="configTabs" class="nav" role="tablist">
      <li *ngIf="!isRemote" role="presentation" class="nav-item">
          <button id="repo-info" class="btn btn-link nav-link" aria-controls="info" [class.active]='isCurrentTabLink("repo-info")' type="button" (click)='tabLinkClick("repo-info")'>{{'REPOSITORY.INFO' | translate}}</button>
      </li>
      <li role="presentation" class="nav-item">
          <button id="repo-image" class="btn btn-link nav-link active" aria-controls="image" [class.active]='isCurrentTabLink("repo-image")' type="button" (click)='tabLinkClick("repo-image")'>{{'REPOSITORY.IMAGE' | translate}}</button>
      </li>
      <li *ngIf="isRemote" role="presentation" class="nav-item">
        <button id="repo-jobLog" class="btn btn-link nav-link" aria-controls="jobLog" [class.active]='isCurrentTabLink("repo-jobLog")' type="button" (click)='loadFirstPage("repo-jobLog")'>拉取任务</button>
      </li>
    </ul>
    <section id="info" role="tabpanel" aria-labelledby="repo-info" [hidden]='!isCurrentTabContent("info")'>
      <form  *ngIf="!isRemote" #repoInfoForm="ngForm">
        <div id="info-edit-button">
          <button class="btn btn-sm" [disabled]="editing || !hasProjectAdminRole " (click)="editInfo()" ><clr-icon shape="pencil" size="16"></clr-icon>&nbsp;{{'BUTTON.EDIT' | translate}}</button>
        </div>
        <div *ngIf="!editing">
          <div *ngIf="!hasInfo()" class="no-info-div">
            <p>{{'REPOSITORY.NO_INFO' | translate }}<p>
          </div>
          <div *ngIf="hasInfo()" class="info-div">
            <pre class="info-pre">{{ imageInfo }}</pre>
          </div>
        </div>
        <div *ngIf="editing">
            <textarea rows="5"  name="info-edit-textarea" [(ngModel)]="imageInfo"></textarea>
        </div>
        <div class="btn-sm" *ngIf="editing">
          <button class="btn btn-primary" [disabled]="!hasChanges()" (click)="saveInfo()" >{{'BUTTON.SAVE' | translate}}</button>
          <button class="btn" (click)="cancelInfo()" >{{'BUTTON.CANCEL' | translate}}</button>
        </div>
        <confirmation-dialog #confirmationDialog (confirmAction)="confirmCancel($event)"></confirmation-dialog>
      </form>
    </section>
    <section id="image" role="tabpanel" aria-labelledby="repo-image" [hidden]='!isCurrentTabContent("image")'>
      <div id=images-container>
        <hbr-tag ngProjectAs="clr-dg-row-detail" (tagClickEvent)="watchTagClickEvt($event)" (signatureOutput)="saveSignatures($event)" class="sub-grid-custom" [repoName]="repoName" [registryUrl]="registryUrl" [withNotary]="withNotary" [withClair]="withClair" [withAdmiral]="withAdmiral" [hasSignedIn]="hasSignedIn" [hasProjectAdminRole]="hasProjectAdminRole" [isGuest]="isGuest" [projectId]="projectId" [isRemote]="isRemote"></hbr-tag>
      </div>
    </section>
    <section *ngIf="isRemote" id="jobLog"  role="tabpanel" aria-labelledby="repo-jobLog" [hidden]='!isCurrentTabContent("jobLog")'>
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <clr-datagrid [clrDgLoading]="jobsLoading" (clrDgRefresh)="clrLoadJobs($event)">
          <clr-dg-column>{{'REPLICATION.NAME' | translate}}</clr-dg-column>
          <clr-dg-column>{{'REPLICATION.STATUS' | translate}}</clr-dg-column>
          <clr-dg-column *ngIf="!isRemote">{{'REPLICATION.OPERATION' | translate}}</clr-dg-column>
          <clr-dg-column *ngIf="isRemote">执行人</clr-dg-column>
          <clr-dg-column>{{'REPLICATION.CREATION_TIME' | translate}}</clr-dg-column>
          <clr-dg-column>{{'REPLICATION.UPDATE_TIME' | translate}}</clr-dg-column>
          <clr-dg-column>{{'REPLICATION.LOGS' | translate}}</clr-dg-column>
          <clr-dg-placeholder>{{'REPLICATION.JOB_PLACEHOLDER' | translate }}</clr-dg-placeholder>
          <clr-dg-row *ngFor="let j of jobs">
            <clr-dg-cell>{{j.repository}}</clr-dg-cell>
            <clr-dg-cell>{{j.status}}</clr-dg-cell>
            <clr-dg-cell>{{j.operation}}</clr-dg-cell>
            <clr-dg-cell>{{j.creation_time | date: 'short'}}</clr-dg-cell>
              <clr-dg-cell>{{j.update_time | date: 'short'}}</clr-dg-cell>
              <clr-dg-cell>
              <span *ngIf="j.status=='pending'; else elseBlock" class="label">{{'REPLICATION.NO_LOGS' | translate}}</span>
              <ng-template #elseBlock>
                <a href="javascript:void(0);" (click)="viewLog(j.id)">
                  <clr-icon shape="clipboard"></clr-icon>
                </a></ng-template>
            </clr-dg-cell>
          </clr-dg-row>
          <clr-dg-footer>
            <span *ngIf="showPaginationIndex">{{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} {{'REPLICATION.OF' | translate}}</span>
            {{pagination.totalItems}} {{'REPLICATION.ITEMS' | translate}}
            <clr-dg-pagination #pagination [(clrDgPage)]="currentPage" [clrDgPageSize]="pageSize" [clrDgTotalItems]="totalCount"></clr-dg-pagination>
          </clr-dg-footer>
        </clr-datagrid>
      </div>

      <job-log-viewer #replicationLogViewer></job-log-viewer>
    </section>
  </div>
</section>